import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as m}from"./index.GzzYzsTh.js";import{T as S,U as D,V as O,X as C,Y as N,W as A,Z as L,_ as R}from"./LineChart.Di7AruUN.js";import"./index.BSy9ry4M.js";async function w(e){const r=await fetch(e,{cache:"no-cache"});if(!r.ok)throw new Error(`Fetch failed: ${e}`);return r.json()}const y=["#2563eb","#16a34a","#dc2626","#7c3aed","#ea580c","#0891b2","#b91c1c","#0ea5e9","#a16207","#4f46e5"];function E(e){const r=new Set;for(const n of Object.values(e))for(const i of n.series)r.add(i.date);const a=Array.from(r).sort(),o={};for(const[n,i]of Object.entries(e)){o[n]={};for(const d of i.series)o[n][d.date]=d.value}return a.map(n=>{const i={date:n};for(const d of Object.keys(e))i[d]=o[d][n]??null;return i})}function G(e){const r=[];for(let a=1;a<e.length;a++){const o=e[a-1].value,n=e[a].value;o&&n&&r.push(n/o-1)}return r}function T(e){let r=-1/0,a=0;for(const o of e){o.value>r&&(r=o.value);const n=r?o.value/r-1:0;n<a&&(a=n)}return Math.abs(a)}function V(e,r){const a=new Date(e).getTime(),o=new Date(r).getTime();return Math.max((o-a)/(1e3*60*60*24*365.25),1/365)}function B(e){if(!e||e.length<2)return{CAGR:0,VOL:0,Sharpe:0,MDD:0};const r=V(e[0].date,e[e.length-1].date),a=e[0].value,o=e[e.length-1].value,n=a>0?Math.pow(o/a,1/r)-1:0,i=G(e),d=i.length?i.reduce((g,u)=>g+u,0)/i.length:0,b=i.length>1?i.reduce((g,u)=>g+Math.pow(u-d,2),0)/(i.length-1):0,x=Math.sqrt(b)*Math.sqrt(252),k=x?d*252/x:0,v=T(e);return{CAGR:n,VOL:x,Sharpe:k,MDD:v}}function K(){const[e,r]=m.useState({}),[a,o]=m.useState([]),[n,i]=m.useState({}),[d,b]=m.useState(!1);m.useEffect(()=>{w("/data/universe_v1/registry.json").then(s=>r(s||{})).catch(()=>r({}))},[]),m.useEffect(()=>{if(!e||a.length)return;const s=[];e.benchmarks?.[0]&&s.push(e.benchmarks[0].id),e.models?.[0]&&s.push(e.models[0].id),o(s)},[e,a.length]),m.useEffect(()=>{if(!a.length)return;const s=new Set(Object.keys(n)),h=a.filter(c=>!s.has(c));if(!h.length)return;const l={};for(const c of[...e.benchmarks||[],...e.models||[],...e.portfolios||[]])l[c.id]=c.path;b(!0),Promise.all(h.map(async c=>{const f=l[c];if(!f)return[c,null];try{const p=await w(f);return[c,p]}catch{return[c,null]}})).then(c=>{const f={};for(const[p,j]of c)j&&(f[p]=j);i(p=>({...p,...f})),b(!1)})},[a,e,n]);const x=m.useMemo(()=>{const s=[],h=[...e.benchmarks||[],...e.models||[],...e.portfolios||[]];return a.forEach((l,c)=>{const f=h.find(j=>j.id===l),p=n[l];f&&p&&s.push({id:l,label:f.label,color:y[c%y.length],m:B(p.series)})}),s},[a,n,e]),k=m.useMemo(()=>Object.keys(n).length?E(n):[],[n]),v={Benchmarks:e.benchmarks||[],Models:e.models||[],Portfolios:e.portfolios||[]},g=s=>o(h=>h.includes(s)?h.filter(l=>l!==s):[...h,s]),u=s=>`${(s*100).toFixed(2)}%`,M=s=>s.toFixed(2);return t.jsxs("div",{className:"megagraph",children:[t.jsxs("div",{className:"selectors",children:[Object.entries(v).map(([s,h])=>t.jsxs("div",{className:"group",children:[t.jsx("div",{className:"group-title",children:s}),h.map(l=>{const c=a.indexOf(l.id),f=y[(c>=0?c:0)%y.length];return t.jsxs("label",{className:"opt",children:[t.jsx("input",{type:"checkbox",checked:a.includes(l.id),onChange:()=>g(l.id)}),t.jsx("span",{className:"swatch",style:{background:f}}),l.label]},l.id)})]},s)),t.jsx("div",{className:"actions",children:t.jsx("button",{onClick:()=>o([]),children:"Clear"})})]}),t.jsxs("div",{className:"chart-wrap",children:[t.jsx(S,{width:"100%",height:420,children:t.jsxs(D,{data:k,margin:{top:10,left:0,right:10,bottom:10},children:[t.jsx(O,{strokeDasharray:"3 3"}),t.jsx(C,{dataKey:"date",minTickGap:32}),t.jsx(N,{}),t.jsx(A,{}),t.jsx(L,{}),x.map(s=>t.jsx(R,{type:"monotone",dataKey:s.id,name:s.label,dot:!1,stroke:s.color,strokeWidth:2,isAnimationActive:!1},s.id))]})}),d&&t.jsx("div",{className:"loading",children:"Loadingâ€¦"})]}),t.jsx("div",{className:"stats",children:t.jsxs("table",{children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Series"}),t.jsx("th",{children:"CAGR"}),t.jsx("th",{children:"Vol"}),t.jsx("th",{children:"Sharpe"}),t.jsx("th",{children:"Max DD"})]})}),t.jsx("tbody",{children:x.map(s=>t.jsxs("tr",{children:[t.jsxs("td",{children:[t.jsx("span",{className:"swatch",style:{background:s.color}}),s.label]}),t.jsx("td",{children:u(s.m.CAGR)}),t.jsx("td",{children:u(s.m.VOL)}),t.jsx("td",{children:M(s.m.Sharpe)}),t.jsx("td",{children:u(s.m.MDD)})]},s.id))})]})}),t.jsx("style",{children:`
        .megagraph { display:grid; gap:1rem; }
        .selectors { display:flex; flex-wrap:wrap; gap:1rem; align-items:flex-start; }
        .group { border:1px solid #eee; border-radius:12px; padding:.75rem; min-width:220px; background:#fff; }
        .group-title { font-weight:700; margin-bottom:.5rem; }
        .opt { display:flex; align-items:center; gap:.5rem; margin:.25rem 0; }
        .swatch { display:inline-block; width:12px; height:12px; border-radius:3px; margin-right:.25rem; }
        .actions button{ border:1px solid #ddd; border-radius:10px; padding:.4rem .6rem; background:#fafafa; }
        .chart-wrap { position:relative; border:1px solid #eee; border-radius:12px; padding:.5rem; background:#fff; }
        .loading { position:absolute; right:12px; top:8px; color:#555; }
        .stats table { width:100%; border-collapse:collapse; background:#fff; border:1px solid #eee; border-radius:12px; overflow:hidden; }
        .stats th,.stats td{ padding:.5rem .6rem; border-bottom:1px solid #f2f2f2; text-align:left; }
        .stats tr:last-child td{ border-bottom:0; }
        @media (max-width:820px){ .selectors{flex-direction:column;} }
      `})]})}export{K as default};
