---
import BaseLayout from "../../layouts/BaseLayout.astro";
export const prerender = true;
---
<BaseLayout title="Pipelines · EireQuant" description="Choose a pipeline to explore.">
  <section class="hero">
    <h1 class="h1">Pipelines</h1>
    <p class="lead">Select a pipeline. Live shows current outputs; Workstation covers theory and experiments.</p>
  </section>

  <div class="tiles">
    <!-- Live Pipeline tile -->
    <a class="tile" href="/pipelines/live/">
      <div class="tile-h">Live Pipeline</div>
      <div class="tile-kv"><span>Status</span><strong id="status">—</strong></div>
      <div class="tile-kv"><span>Last run</span><strong id="lastrun">—</strong></div>
      <div class="tile-kv"><span>Trading</span><strong id="trading">—</strong></div>
      <div class="tile-kv"><span>Current regime</span><strong id="regime">—</strong></div>
      <div class="tile-cta">Open →</div>
    </a>

    <!-- Workstation (Sim) tile -->
    <a class="tile" href="/pipelines/sim/">
      <div class="tile-h">Workstation (Sim)</div>
      <p class="muted">Where new models are created and tested. Methods, code notes, and roadmap.</p>
      <div class="tile-cta">Open →</div>
    </a>
  </div>

  <style>
    .h1{ font-family: Georgia, 'Times New Roman', serif; margin:0 0 6px 0; }
    .lead{ color:#555; }
    .tiles{ display:grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap:16px; margin-top:16px; }
    .tile{
      display:block; border:2px solid #d7d7d7; border-radius:6px; background:#fff; padding:16px;
      text-decoration:none; color:inherit; transition: box-shadow .12s ease;
      min-height: 180px;
    }
    .tile:hover{ box-shadow:0 2px 12px rgba(0,0,0,.06); }
    .tile-h{ font-weight:700; margin-bottom:8px; }
    .tile-kv{ display:flex; justify-content:space-between; border-bottom:1px dashed #eee; padding:6px 0; }
    .tile-kv:last-of-type{ border-bottom:0; }
    .tile-cta{ margin-top:12px; font-weight:600; color:#0645ad; }
    .muted{ color:#6b6b6b; }
  </style>

  <script type="module">
    const $ = (s) => document.querySelector(s);
    async function j(path){ try{ const r = await fetch(path); if(!r.ok) return null; return await r.json(); }catch{ return null; } }

    (async () => {
      const status = await j("/data/pipeline/status.json");
      if (status) $("#status").textContent = status.state ?? status.status ?? "—";

      const latest = await j("/data/daily/latest.json");
      if (latest) $("#lastrun").textContent = latest.date ?? "—";

      const pom = await j("/data/models/eqx-m1/pause_o_meter.json");
      if (pom) $("#trading").textContent = pom.state ?? pom.mode ?? "—";

      const reg = await j("/data/models/eqx-m1/current_regime.json");
      if (reg) $("#regime").textContent = reg.name ?? reg.regime ?? "—";
    })();
  </script>
</BaseLayout>
