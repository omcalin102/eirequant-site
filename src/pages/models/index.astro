---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import modelSeries from "../../lib/modelSeries";

const all = await getCollection("models");

// Group models by series according to modelSeries order
const grouped = modelSeries.map(s => {
  const items = all
    .filter(m => m.data.series === s.slug)
    .sort((a,b) => (a.data.mark ?? 0) - (b.data.mark ?? 0));
  return { meta: s, items };
});

// Simple blurb for Experimental Series (we want this surfaced first)
const experimentalIntro = "Research-first family for prototypes and cutting-edge signals. EQX-M1 is the first tangible model in this series.";
---
<BaseLayout title="Models · EireQuant" description="Explore EireQuant model families and their Marks.">

  <!-- Experimental Series (surfaced first, clean + minimal data) -->
  <section class="series" id="experimental">
    <header class="series-head">
      <div>
        <div class="kicker">Series</div>
        <h2>Experimental Series</h2>
        <p class="sub">{experimentalIntro}</p>
      </div>
      <a class="series-link" href="/models/eqx-m1/">View EQX-M1 →</a>
    </header>

    <div class="cards">
      <a class="card" href="/models/eqx-m1/">
        <div class="meta">Mk 1 · research</div>
        <h3>EQX-M1</h3>
        <p>First model in the EQ Experimental Series. Focused, professional, and evolving.</p>
      </a>
    </div>
  </section>

  <!-- Existing series rendered from content collection -->
  {grouped.map(({ meta, items }) => (
    <section class="series" id={meta.slug}>
      <header class="series-head">
        <div>
          <div class="kicker">Series</div>
          <h2>{meta.title}</h2>
          {meta.subtitle && <p class="sub">{meta.subtitle}</p>}
        </div>
        <a class="series-link" href={`/models/series/${meta.slug}/`}>View series →</a>
      </header>

      {items.length > 0 ? (
        <div class="cards">
          {items.map(({ data }) => (
            <a class="card" href={`/models/${data.slug}/`}>
              <div class="meta">Mk {data.mark} · {data.version ?? "v1.0.0"} · {data.status ?? "research"}</div>
              <h3>{data.title}</h3>
              <p>{data.summary ?? "Model description coming soon."}</p>
            </a>
          ))}
        </div>
      ) : (
        <div class="empty">No marks published yet. Coming soon.</div>
      )}
    </section>
  ))}

  <style>
    .lead{ color:#555; margin-bottom:1rem;}
    .series{ border-top:2px solid #d7d7d7; padding-top:1rem; margin-top:1rem;}
    .series:first-of-type{ border-top:0; padding-top:0; margin-top:.5rem;}
    .series-head{ display:flex; align-items:end; justify-content:space-between; gap:1rem; }
    .kicker{ font-size:.8rem; text-transform:uppercase; letter-spacing:.04em; color:#666; }
    .sub{ color:#444; margin:.25rem 0 0; }
    .series-link{ white-space:nowrap; font-weight:600; color:#0645ad; text-decoration:none; }
    .series-link:hover{ text-decoration:underline; }

    .cards{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:1rem; margin-top:.75rem; }
    .card{
      border:2px solid #d7d7d7; border-radius:6px; padding:1rem; background:#fff;
      transition: box-shadow .12s ease;
    }
    .card:hover{ box-shadow:0 2px 12px rgba(0,0,0,.06); }
    .card .meta{ font-size:.85rem; color:#555; margin-bottom:.25rem; text-transform:uppercase; letter-spacing:.03em;}
    .empty{ color:#555; background:#fafafa; border:2px dashed #d7d7d7; border-radius:6px; padding:1rem; margin-top:.75rem;}
  </style>
</BaseLayout>
