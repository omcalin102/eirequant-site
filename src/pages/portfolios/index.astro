---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Load all portfolio entries
const raw = await getCollection("portfolios");

// Resolve a display title that works with both schemas
function resolveTitle(entry: any): string {
  const d = entry?.data ?? {};
  return (d.title ?? d.name ?? entry.slug ?? "").toString();
}

// Sort safely by resolved title
const items = raw.sort((a, b) => resolveTitle(a).localeCompare(resolveTitle(b)));
---
<BaseLayout title="Portfolios Â· EireQuant" description="Portfolio allocations with equity and drawdown metrics.">
  <h1>Portfolios</h1>
  <div class="cards">
    {items.map((entry) => {
      const d = entry.data as any;
      const title = d.title ?? d.name ?? entry.slug;
      const href = `/portfolios/${d.slug ?? entry.slug}/`;
      const summary = d.summary ?? d.objective ?? "Description coming soon.";
      return (
        <a class="card" href={href}>
          <div class="kicker">Portfolio</div>
          <h3>{title}</h3>
          <p>{summary}</p>
        </a>
      );
    })}
  </div>

  <style>
    .cards{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:1rem; margin-top:.75rem; }
    .card{ border:1px solid #eee; border-radius:12px; padding:1rem; background:#fff; }
    .card:hover{ border-color:#ddd; box-shadow:0 8px 24px rgba(0,0,0,.06); }
    .kicker{ font-size:.8rem; text-transform:uppercase; color:#666; }
  </style>
</BaseLayout>
