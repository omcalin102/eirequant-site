---
interface Props { currentPath?: string }
const { currentPath = "/" } = Astro.props;

// Centralized routes used by the menus (keep in sync with homepage links)
const links = {
  models: {
    overview: "/models/",
    core:        { label: "Core Series",        href: "/models/series/eq-core/" },
    sentinel:    { label: "Sentinel Series",    href: "/models/series/eq-sentinel/" },
    experimental:{ label: "Experimental Series",href: "/models/series/eq-tbd/" },
    feature:     { label: "EQX-M1 (Model Card)",href: "/models/eqx-m1/" },
  },
  pipelines: [
    { label: "Overview", href: "/pipelines/" },
    { label: "Live Pipeline", href: "/pipelines/live/" },
    { label: "Workstation (Sim)", href: "/pipelines/sim/" },
  ],
};

const isActive = (path: string) =>
  currentPath === path || (path !== "/" && currentPath.startsWith(path));
---

<nav class="site-header" aria-label="Primary">
  <div class="header-inner">
    <a class="brand" href="/" aria-label="EireQuant home">
      <img class="brand-img" src="/brand/logo-mark.png" alt="EireQuant" />
    </a>

    <!-- Mobile toggle -->
    <input id="nav-toggle" class="nav-toggle" type="checkbox" aria-label="Open menu" />
    <label for="nav-toggle" class="hamburger">
      <span class="hamburger-icon" aria-hidden="true">
        <span></span><span></span><span></span>
      </span>
      <span class="hamburger-label">Menu</span>
    </label>

    <!-- DESKTOP NAV (with dropdowns) -->
    <ul class="primary desktop">
      <li>
        <a
          class={`toplink ${isActive("/") ? "active" : ""}`}
          href="/"
          aria-current={isActive("/") ? "page" : undefined}
        >Home</a>
      </li>

      <li class="dropdown">
        <button
          class={`trigger ${isActive("/models/") ? "active" : ""}`}
          type="button"
          aria-haspopup="true"
          aria-expanded="false"
        >Models</button>
        <div class="menu" role="menu" aria-label="Models">
          <ul class="menu-col">
            <li><a class="menu-link" href={links.models.overview} role="menuitem">Overview</a></li>

            <li class="has-flyout">
              <a class="menu-section" href={links.models.core.href}>{links.models.core.label}</a>
            </li>

            <li class="has-flyout">
              <a class="menu-section" href={links.models.sentinel.href}>{links.models.sentinel.label}</a>
            </li>

            <li class="has-flyout">
              <a class="menu-section" href={links.models.experimental.href}>{links.models.experimental.label}</a>
              <div class="flyout" role="menu" aria-label="Experimental">
                <a class="flyout-link" href={links.models.feature.href} role="menuitem">
                  {links.models.feature.label}
                </a>
              </div>
            </li>
          </ul>
        </div>
      </li>

      <li class="dropdown">
        <button
          class={`trigger ${isActive("/pipelines/") ? "active" : ""}`}
          type="button"
          aria-haspopup="true"
          aria-expanded="false"
        >Pipelines</button>
        <div class="menu" role="menu" aria-label="Pipelines">
          <ul class="menu-col">
            {links.pipelines.map(p => (
              <li><a class="menu-link" href={p.href} role="menuitem">{p.label}</a></li>
            ))}
          </ul>
        </div>
      </li>

      <li>
        <a class={`toplink ${isActive("/compare/") ? "active" : ""}`} href="/compare/"
           aria-current={isActive("/compare/") ? "page" : undefined}>Compare</a>
      </li>
      <li>
        <a class={`toplink ${isActive("/about/") ? "active" : ""}`} href="/about/"
           aria-current={isActive("/about/") ? "page" : undefined}>About</a>
      </li>
      <li>
        <a class={`toplink ${isActive("/blog/") ? "active" : ""}`} href="/blog/"
           aria-current={isActive("/blog/") ? "page" : undefined}>Blog</a>
      </li>
    </ul>

    <!-- MOBILE NAV (flat menu, no submenus) -->
    <ul class="primary mobile" id="mobile-menu" role="menu" aria-label="Mobile">
      <li><a class={`toplink ${isActive("/") ? "active" : ""}`} href="/">Home</a></li>
      <li><a class={`toplink ${isActive("/models/") ? "active" : ""}`} href="/models/">Models</a></li>
      <li><a class={`toplink ${isActive("/pipelines/") ? "active" : ""}`} href="/pipelines/">Pipelines</a></li>
      <li><a class={`toplink ${isActive("/compare/") ? "active" : ""}`} href="/compare/">Compare</a></li>
      <li><a class={`toplink ${isActive("/about/") ? "active" : ""}`} href="/about/">About</a></li>
      <li><a class={`toplink ${isActive("/blog/") ? "active" : ""}`} href="/blog/">Blog</a></li>
    </ul>
  </div>
</nav>

<style>
  .toplink.active,
  .trigger.active {
    font-weight: 700;
    text-decoration: underline;
    text-underline-offset: 3px;
  }
  .brand-img{ height:28px; width:auto; display:block; }
  @media(min-width:1280px){ .brand-img{ height:30px; } }
</style>
