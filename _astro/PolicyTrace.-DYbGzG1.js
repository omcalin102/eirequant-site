import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.CQ95-tCy.js";const C=()=>(document.querySelector("base")?.getAttribute("href")||"/").replace(/\/+$/,"/");async function x(n){const d=C()+n.replace(/^\//,"");try{const o=await fetch(d,{cache:"no-cache"});return o.ok?await o.json():null}catch{return null}}const I=n=>typeof n=="number"?n:+new Date(n)||0;function Y(){const n=f.useRef(null),d=f.useRef(null),[o,p]=f.useState([]),[S,R]=f.useState(null);return f.useEffect(()=>{(async()=>{const r=(await x("/data/latest.json"))?.date??null;R(r);let e=null;r&&(e=await x(`/data/daily/${r}/pid_policy_trace.json?v=${encodeURIComponent(r)}`)),e?.trace?.length||(e=await x("/data/models/eqx-m1/pid_policy_trace.json")),p(e?.trace??[])})()},[]),f.useEffect(()=>{const l=n.current,r=d.current;if(!l||!r)return;const e=l.getContext("2d");if(!e)return;const h=Math.max(560,Math.min(1e3,Math.floor(r.clientWidth))),c=220;if(l.width=h,l.height=c,e.clearRect(0,0,h,c),e.font="12px Inter, system-ui, sans-serif",!o.length){e.fillStyle="#777",e.fillText("No policy trace data.",12,20);return}const a=36,u=o.map(t=>I(t.t)),b=o.flatMap(t=>[t.p,t.i,t.d,t.control]).filter(t=>typeof t=="number"),g=Math.min(...u),E=Math.max(...u),v=Math.min(...b),N=Math.max(...b),P=t=>a+(t-g)/Math.max(1,E-g)*(h-2*a),D=t=>c-a-(t-v)/Math.max(1e-9,N-v)*(c-2*a);e.strokeStyle="#e5e5e5",e.lineWidth=1,e.beginPath(),e.moveTo(a,c-a),e.lineTo(h-a,c-a),e.stroke(),e.beginPath(),e.moveTo(a,a),e.lineTo(a,c-a),e.stroke();const T=[{key:"p",label:"P",color:"#0e0e0e"},{key:"i",label:"I",color:"#1e90ff"},{key:"d",label:"D",color:"#ff8c00"},{key:"control",label:"Control",color:"#2e7d32"}],_=Math.max(1,Math.floor(o.length/(h/2)));T.forEach(t=>{const w=o.map((s,m)=>({x:u[m],y:s[t.key]})).filter((s,m)=>m%_===0).filter(s=>typeof s.y=="number");w.length&&(e.beginPath(),w.forEach((s,m)=>{const M=P(s.x),k=D(s.y);m?e.lineTo(M,k):e.moveTo(M,k)}),e.strokeStyle=t.color,e.lineWidth=1.8,e.stroke())});let y=a,j=a-10;T.forEach(t=>{e.fillStyle=t.color,e.fillRect(y,j-3,22,3),e.fillStyle="#333",e.fillText(t.label,y+28,j),y+=28+e.measureText(t.label).width+16})},[o]),f.useEffect(()=>{const l=d.current;if(!l)return;const r=new ResizeObserver(()=>p(e=>[...e]));return r.observe(l),()=>r.disconnect()},[]),i.jsxs("div",{ref:d,className:"card",children:[i.jsxs("div",{className:"card-head",children:[i.jsx("h3",{className:"card-title",children:"Policy Control Trace"}),i.jsx("div",{className:"card-sub",children:S??"ï¿½"})]}),i.jsx("div",{style:{height:220,marginTop:".5rem"},children:i.jsx("canvas",{ref:n})}),i.jsx("div",{className:"muted",style:{marginTop:".5rem"},children:"Shared axis; raw P/I/D/control magnitudes."})]})}export{Y as default};
